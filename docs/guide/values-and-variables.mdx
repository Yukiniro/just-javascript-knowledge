# 值和变量

我们将通过一个代码片段来启动这个模块。

```js
let reaction = 'yikes';
reaction[0] = 'l';
console.log(reaction);
```

你期望这段代码能做什么？如果你不确定也没关系。**尝试使用你现有的JavaScript 知识来找到答案**。

我希望你花点时间一步一步写下你对这段代码每一行的确切思考过程。注意你现有心智模型的差距或者不确定性，并将它们记录下来。如果你有任何疑问，尽可能清楚地表达出来。

{/* 

首先，我们声明了一个变量 `reaction`，并给它赋值了一个字符串 `'yikes'`。

然后，我们尝试将 `reaction[0]` 的值改为 `'l'`。但是由于原始值的不可变性，`reaction` 是一个字符串，所以这个操作是无效的。

最后，我们使用 `console.log` 打印出 `reaction` 的值为 `'yikes'`。

*/}

:::warning {title="答案"}

这段代码会打印 “yikes” 或者抛出一个错误，这取决于你是否处于[严格模式](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)。它永远不会打印 “likes”。

:::

## 原始值是不可变的

你回答对了吗？这似乎是只会出现在 JavaScript 面试中的琐事问题。即便如此，它说明了有关原始值的重要一点。

**我们无法更改原始值**

我将用一个小示例来解释这一点。字符串（原始值）和数组（非原始值）有一些表面上的相似之处。数组是项的序列，字符串是字符的序列：

```js
let arr = [212, 8, 506];
let str = 'hello';
```

我们可以类似地访问数组的第一个项和字符串的第一个字符。几乎感觉字符串就是数组：

```js
console.log(arr[0]); // 212
console.log(str[0]); // 'h'
```

但是事实并非如此。让我们仔细看看。我们可以改变数组的第一个项：

```js
arr[0] = 420;
console.log(arr); // [420, 8, 506]
```

直观地看，很容易假设说字符串也可以做相同的操作：

```js
str[0] = 'j'; // ???
```

**但是我们不能**。

这是一个需要加入到我们的心智模型的重要的细节。字符串是原始值，并且**所有的原始值都是不可变的**。“不可变”是“无法变化的”花哨拉丁语。“只读”。我们完全无法污染原始值。

JavaScript 不会允许我们在任何原始值上设置属性，无论是数字、字符串还是其他的原始值。我们的请求（设置属性）无效或者抛出错误取决于我们所处的[模式](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)。但是能够确认的是这永远无法生效：

```js
let fifity = 50;
fifity.shades = 'gray'; // No!
```

与任何数字一样，`50` 是一个原始值。我们不能设置它的属性。

请记住，在我们的 JavaScript 宇宙中，所有的原始值都是遥远的星星，漂浮在距离我们代码最远的地方。我们可以指向它们，但是它们总是保持在原地，无法改变。

_我发现这奇怪地令人欣慰_

![immutablemap3.png](/immutablemap3.png)

## 变量和值 -- 矛盾？

你已经看到，原始值是只读的 -- 或者用现在的话说，不可变。现在，使用下面的代码片段测试你的心智模型。

```js
let pet = 'Narwhal';
pet = 'The Kraken';
console.log(pet); // ?
```

跟之前一样，用几句话写下你的思考过程。不要急于求成。请密切关注你是如何一步一步思考代码的每一行的。字符串的不可变性在这里有扮演角色吗？如果有，扮演的是什么角色？

{/* 

打印 “The Kraken”。

没有什么作用，因为 pet 直接被赋值了另一个值，所以没有用到不可变性。

*/}

:::warning{title="答案"}

如果你认为我试图弄乱你想法，那你是对的！答案是 “The Kraken”。不可变性在这里不起作用。

如果你弄错了也不要失望！这个例子看起来跟字符串的不可变性有矛盾。但是**事实并非如此**。

当你刚接触一门语言时，有时候搁置矛盾是有必要的，这样你就可以避免跳进兔子洞并继续学习。但是现在你致力于建立心智模型，你需要质疑矛盾。

_矛盾揭示了心智模型的差距_

:::

## 变量是线

让我们再次看一下这个例子。

```js
let pet = 'Narwhal';
pet = 'The Kraken';
console.log(pet); // "The Kraken"
```

我们知道字符串值不能改变因为它们是原始值。但是 `pet` 变量确实更改为了 `'The Kraken'`。这是怎么回事？

这似乎是一个矛盾，但是不是。我们说原始值不能改变，但是我们没有谈及 _变量_！当我们完善我们的心智模型时，我们需要理清几个相关的概念。

#### 变量不是值。

#### 变量指向值。

## 为变量赋值

在我们的 JavaScript 宇宙中，变量是指向值的线。

例如，我可以将 `pet` 变量指向 `'Narwhal'` 值。（我也可以说，我将值 `'Narwhal'` 赋值给了名为 `pet` 的变量。）：

```js
let pet = 'Narwhal';
```

<video src="/Assigning-Narwhal-value-to-the-pet.webm" autoPlay loop muted controls />

我在这里所做的只是指示 JavaScript 将左侧的变量（`pet`），或者说是“线”，指向右侧的值（`'Narwhal'`）。除非我稍后重新分配它，否则它将一直指向该值。

## 分配规则

当我们想要使用 `=` 赋值运算符时，有两个规则：

1. **赋值的左侧必须是“线” -- 比如 `pet` 变量**。记住左侧不能是值。（尝试在控制面板中使用下面的示例）：

```js
2000 = 'leagues under the sea'; // 不行！
'war' = 'peace'; // 不行！
```

2. **赋值的右侧必须是表达式，它的结果总是值**。我们的表达式有时候很简单，比如 `2` 或者 `hello`。也可以是更加复杂的表达式 -- 例如：

```js
pet = count + ' Delmations';
```

这里，`count + ' Delmations'` 是一个表达式 -- 给 JavaScript 的问题。JavaScript 会用一个值回答（例如，`101 Delmations`）。从现在开始，`pet` 变量的”线“将指向那个特定的值。

:::warning{title="趣闻"}

如果右侧必须是一个表达式，是否意味着代码中这样的简单事物 -- 像 `2` 这样的数字或者像 `'The Kraken'` 这样的字符串 -- 也是表达式？是的！这样的表达式被称为字面量 -- 因为我们能在字面上直接写出它们作为结果的值。

:::

## 读取变量的值

我还可以读取变量的值 -- 例如，打印它：

```js
console.log(pet);
```

这并不奇怪。

但是请注意，我们传递给 `console.log` 的不是 `pet` 变量。我们可以这样通俗地说，但是我们不能真的传递变量给函数。我们传递的是 `pet` 变量当时的值。这是如何工作的？

事实证明，像 `pet` 这样的变量名称也可以用作表达式！当我们写下 `pet` 时，可以看作是我们像 JavaScript 提出一个问题：“`pet` 当前的值什么？”。为了回答这个问题，JavaScript 会找到 `pet` 线，并给我们返回”线“的尾端的值。

所以同一个表达式会在不同的时候给我们不同的值！

## 挑剔

谁会在乎你说的是”传递一个变量“还是”传递一个值“呢？这种差异是不可救药的迂腐吗？我绝对不鼓励打断你的同事来纠正他们。那会浪费大家的时间。

但是你需要清楚地知道你可以利用你脑海里的每个 JavaScript 概念做什么。你不能在自行车上滑冰。你不能驾驶一个鳄梨。你不能对着蚊子唱歌。当然你也不能传递变量 -- 至少在 JavaScript 中不能。

下面是一个小示例，说明为什么这些细节如此重要。

```js
function double(x) {
    x = x * 2;
}

let money = 10;
double(money);
console.log(money); // ?
```

如果我们认为 `double(money)` 是在传递变量，我们可能会期望 `x = x * 2` 会使 `money` 变量增加一倍。但是它没有。为什么？

但那是不对的：`double(money)` 的意思是 “找到 `money` 的值，并将其传递给 `double` 函数”。所以 `money` 仍然指向 `10`。真是个骗局！

你脑海中有哪些不同的 JavaScript 概念？它们如何相互关联，我们如何通过代码与它们交互？

写下你最常使用的简短列表。

## 把它们放在一起

现在然我们回顾一个[心智模型](/guide/mental-models)的第一个示例：

```js
let x = 10;
let y = x;
x = 0;
```

<video src="/let-x-10.webm" autoPlay loop muted controls />

第一行没什么用：

- 声明一个名为 `x` 的变量。
  - 绘制 `x` 变量的”线“。
- 将 `10` 分配给 `x`。
  - **`x` 线指向 `10`**

<video src="/let-y-x.webm" autoPlay loop muted controls />

第二行很短，但它做了很多事情：

- 声明一个名为 `y` 的变量。
  - 绘制 `y` 变量的”线“。
- 将 `x` 的值分配给 `y`。
  - 计算表达式：`x`。
    - 我们想要回答的“问题”是 `x`。
    - **沿着 `x` 线 -- 答案是值 `10`**
  - `x` 表达式的结果是 `10`。
  - 因此，将值 `10` 分配给 `y`。
  - **`y` 线指向 `10`**

最后，我们进入第三行：

<video src="/x-0.webm" autoPlay loop muted controls />

- 将值 `0` 分配给 `x`。
  - **`x` 线指向 `0`**

**请注意，`y = x` 并不意味着 `y` 指向 `x`。我们不能将变量指向彼此！变量永远指向值**。当我们看见一个赋值时，可以认为是我们“询问”右侧的值，并将左侧的线指向该值。

我在心智模型中提及将变量视作盒子是很常见的。但是我们构建的宇宙不会有任何盒子。**只有线**。

这可能看起来有点烦人，但是使用线可以更加容易地解释许多其他概念，比如说严格相等、对象标识和突变。我们将坚持使用线，所以你最好现在就开始习惯它们！

_我们的宇宙到处都是线_。

## 回顾

- **原始值是不可变的**。它们是我们 JavaScript 宇宙的永久组成部分 -- 我们不能创建、销毁或者改变它们。例如，我们不能设置一个字符串的属性，因为它是一个原始值。数组不是原始值，所以我们可以设置它们的属性。
- **变量不是值**。每个变量指向一个特定的值。我们可以使用 `=` 赋值运算改变变量的指向。
- **变量像线**。“线”不是 JavaScript 概念 -- 但是它有助于我们想象变量是如何指向值的。当我们进行赋值时，左侧总是有线，右侧总是有表达式（产生值）。
- **注意矛盾**。如果你学习的两件事貌似相互矛盾，请不要气馁。通常，这说明下面潜伏着更深层次的真相。
- **语言很重要**。我们正在构建一个心智模型，以便我们有信心弄清楚在我们的宇宙中哪些可以发生，哪些不能发生。我们可能会以随意的方式谈论这些想法（吹毛求疵通常适得其反），但是我们对术语背后的含义的理解需要准确。
